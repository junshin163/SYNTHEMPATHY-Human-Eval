<link rel="stylesheet" href="styles.css">
<body>
    <h1>Empathy Ranking Form</h1>
    <h4>Please rank each response in order of most to least empathetic</h4>
    <form action="https://api.web3forms.com/submit" method="post">
        <input type="hidden" name="access_key" value="0bede88b-9799-4317-9c57-a48498a4699a">

        <div id="questionContainer"></div>

        <button type="submit">Submit</button>
    </for>

    <div class="thank-you-message" id="thankYouMessage" style="display: none;">
        <h1>Thank You!</h1>
        <p>Your response has been recorded. Thank you for completing the survey.</p>
    </div>

    <script>
        const csvFilePath = 'resp_comparison.csv'; // Path to your CSV file
        let prompts = [];

        // Function to load prompts from CSV
        function loadPrompts() {
            Papa.parse(csvFilePath, {
                download: true,
                header: true,
                complete: function(results) {
                    prompts = results.data; // Store parsed prompts
                    loadVariant(); // Load the selected variant after prompts are loaded
                }
            });
        }

        // Function to load a variant based on URL parameter
        function loadVariant() {
            const urlParams = new URLSearchParams(window.location.search);
            const variantIndex = parseInt(urlParams.get('variant')) || 0; // Default to the first variant

            // Determine the start and end indices for the questions
            const startIndex = variantIndex;
            const endIndex = variantIndex + 5; // Load 5 questions

            // Create question HTML
            const questionContainer = document.getElementById('questionContainer');
            let questionHTML = '';

            for (let i = startIndex; i < endIndex && i < prompts.length; i++) {
                const prompt = prompts[i];
                questionHTML += `
                    <div class="question">
                        <p>${prompt.prompt}</p>
                        <label>Response 1: "${prompt.ED_resp}"</label>
                        <select name="question${i + 1}_response1" class="response-select">
                            <option value="">Select a rank</option>
                            <option value="1">1 (Most Empathetic)</option>
                            <option value="2">2</option>
                            <option value="3">3 (Least Empathetic)</option>
                        </select>
                        <label>Response 2: "${prompt.EPITOME_resp}"</label>
                        <select name="question${i + 1}_response2" class="response-select">
                            <option value="">Select a rank</option>
                            <option value="1">1 (Most Empathetic)</option>
                            <option value="2">2</option>
                            <option value="3">3 (Least Empathetic)</option>
                        </select>
                        <label>Response 3: "${prompt.SYNTHEMPATHY_resp}"</label>
                        <select name="question${i + 1}_response3" class="response-select">
                            <option value="">Select a rank</option>
                            <option value="1">1 (Most Empathetic)</option>
                            <option value="2">2</option>
                            <option value="3">3 (Least Empathetic)</option>
                        </select>
                    </div>
                `;
            }
            questionContainer.innerHTML = questionHTML;

            // Add event listener to form submission
            document.getElementById('empathyForm').addEventListener('submit', handleFormSubmit);
        }

        // Function to handle form submission
        function handleFormSubmit(event) {
            event.preventDefault(); // Prevent the default form submission

            const selects = document.querySelectorAll('.response-select');
            const uniqueRanks = new Set();
            let isValid = true;

            // Check for unique ranks
            selects.forEach(select => {
                const value = select.value;
                if (value) {
                    if (uniqueRanks.has(value)) {
                        isValid = false; // Found a duplicate rank
                    } else {
                        uniqueRanks.add(value);
                    }
                }
            });

            if (isValid) {
                // Here you would normally submit the form data to your server
                // Since we're using web3forms, we'll simulate form submission
                // For now, we'll just show the thank you message
                document.getElementById('empathyForm').style.display = 'none';
                document.getElementById('thankYouMessage').style.display = 'block';
            } else {
                alert('Please select unique ranks for each question.');
            }
        }

        loadPrompts(); // Start loading prompts
    </script>

</body>